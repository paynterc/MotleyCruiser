<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>obj_ship_module</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>604</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>0</useapplyto>
        <exetype>1</exetype>
        <functionname>action_inherited</functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Init
shooting = false;
gundata = noone;
weapon_speed = 1;
weapon_range = 0;
hitpoint = noone;
hitobject = noone;

//Instantiate a spark
spark = instance_create(x,y,obj_spark);


alarm[0]=room_speed;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="1" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Deactivate spark
with(spark){
    active = 0;
    instance_destroy();
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Shoot a bullet

//First populate the gun data using the module prototype
if(gundata==noone){

    if(m_proto!=noone &amp;&amp; m_proto[MODULE_TYPE_INDEX]!=noone &amp;&amp; m_proto[MODULE_TYPE_INDEX]&lt;array_length_1d(global.guns)){
        gundata = global.guns[m_proto[MODULE_TYPE_INDEX]];
    }else{
        gundata = global.guns[0];
    }    
    weapon_speed = gundata[GUN_SPEED];
    weapon_range = gundata[GUN_RANGE]
}

if(shooting){


    if(gundata[GUN_BULLET_TYPE]=="beam"){
        if(hitobject!=noone &amp;&amp; hitobject.faction != faction){
            hitobject.register_damage += gundata[GUN_DAMAGE];
            hitobject.hitby = id;
        }   
    }else if(gundata[GUN_BULLET_TYPE]=="bullet"){
        var d = sprite_get_width(sprite_index)/2;
        
        var bullet = instance_create(x + lengthdir_x(d, image_angle),y + lengthdir_y(d, image_angle),obj_laser);
        //bullet = scr_get_from_pool("projectile",obj_projectile);
        //bullet.x = x + lengthdir_x(d, image_angle);
        //bullet.y = y + lengthdir_y(d, image_angle);
        bullet.type=faction;
        bullet.firedby = id;
        bullet.sprite_index = gundata[GUN_BULLET_SPRITE];
        bullet.depth = -200;
        bullet.direction = image_angle;
        bullet.image_angle = image_angle;
        bullet.speed = BULLET_BASE_SPEED;
        bullet.damage = gundata[GUN_DAMAGE];
        
        var b_sound = audio_play_sound_at(snd_laser3,x,y,0,100,100,1,false,2);
        //audio_sound_pitch(b_sound, random_range(.85,1.5));
            
    }
 
    
    
    parent_obj.energy_current -= 2;

    


}

alarm[0] = room_speed * weapon_speed;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Set shooting status
if(parent_obj!=noone 
&amp;&amp; gundata != noone 
&amp;&amp; parent_obj.energy_current&gt;0
&amp;&amp; parent_obj.tgt_dist &lt;= weapon_range
&amp;&amp; !global.paused
){
    shooting = parent_obj.shooting;
}else{
    shooting = false;
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Check for beam hits
if(shooting &amp;&amp; gundata[GUN_BULLET_TYPE]=="beam" ){

    var x1, y1, x2, y2;

    x1 = x + lengthdir_x(guntip, image_angle);
    y1 = y + lengthdir_y(guntip, image_angle);
    x2 = x + lengthdir_x(guntip+gundata[GUN_RANGE], image_angle);
    y2 = y + lengthdir_y(guntip+gundata[GUN_RANGE], image_angle);
    hitobject = collision_line(x1,y1,x2,y2,obj_ship,false,false); 
    if(hitobject!=noone &amp;&amp; hitobject.faction != faction){
        hitpoint = scr_raycast(x1,y1,x2,y2,hitobject);// This will return an array with x,y coords
        if(hitpoint!=noone){
            spark.x = hitpoint[0];
            spark.y = hitpoint[1];
            spark.active = 1;
        }
    }else{
        hitpoint = noone;
        spark.active = 0;
    }
    
}else{
    spark.active = 0;
    hitpoint = noone;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="73">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Draw beam
if(shooting &amp;&amp;  gundata[GUN_BULLET_TYPE]=="beam"){

    if(hitpoint!=noone){
        x2 = hitpoint[0];
        y2 = hitpoint[1];
    }else{
        x2 = x + lengthdir_x(guntip+gundata[GUN_RANGE], image_angle);
        y2 = y + lengthdir_y(guntip+gundata[GUN_RANGE], image_angle);
    }

    draw_set_colour(gundata[GUN_BULLET_COLOR]);
    draw_line(x + lengthdir_x(guntip, image_angle),y + lengthdir_y(guntip, image_angle), x2, y2);
    draw_set_colour(c_white);
    draw_line(x + 1 + lengthdir_x(guntip, image_angle),y + lengthdir_y(guntip, image_angle), x2+1, y2);
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
